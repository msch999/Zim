<!doctype html>
<html>

<head>
  <meta charset="utf-8" />
  <title>EmitterHitter</title>

  <script src="https://d309knd7es5f10.cloudfront.net/createjs_1.1_min.js"></script>
  <script src="https://d309knd7es5f10.cloudfront.net/zim_10.4.1.js"></script>
  <!-- use zimjs.com/distill for minified individual functions! -->

  <script>
  var assets = ["person_surfing.png", "C_D_E_D.001.mp3"];
  var path = "assets/";

  var frame = //new Frame(scaling, width, height, color, outerColor);
      new Frame("fit",
        window.screen.availWidth,
        window.screen.availHeight,
        "#000", "#555", assets, path);

    frame.on("ready", function() {
//      zog("ready from ZIM Frame"); // logs in console (F12 - choose console)

      var stage = frame.stage;
      var stageW = frame.width;
      var stageH = frame.height;

      // put your code here
      var colorPal_Cenicienta3 = ["#034AA6", "#022859", "#034C8C", "#049DBF", "#04C4D9"];
      var colorPal_Gold = ["#a67c00", "#bf9b30", "#ffbf00", "#ffcf40", "#ffdc73"];
      var mostPopColours2019 = [
        //        "#7FFF00", // UFO Green
        "#FF1493", // Plastic Pink
        "#8A2BE2", // Proton Purple
        "#000080", // Australia
        "#006400", // Brazil
        "#00CED1", // Germany
        "#FFF0F5", // Japan
        "#2E8B57", // Korea
        "#808000", // Taiwan
      ];

      var hitParticles = 0;

      var backgroundCircleBelow = new Circle(stageH / 2 + 70, "#111111").centerReg(stage);
      var backgroundCircleTop = new Circle(stageH / 2 - 50, "#333333").centerReg(stage);

      // a text label for displaying the number of hit particles
      var displayHitText = new Label({
          text: "hit particles: " + hitParticles + " Num of Particles: 0",
          size: 17,
          color: yellow,
          align: "left"
        })
        .addTo(stage)
        .pos(50, 50);

      var countDownTimer = 10;
      var iv = interval(1000, function() {
        //zog("repeat after a second");
        if (countDownTimer > 0)
          countDownTimer--;
        else {
          // 5. or use frame.asset(file).play() to play a sound
          // if you want to adjust volume, etc. then assign this to a variable
          // var sound = frame.asset("welcome.mp3").play({volume:2, loop:true});
          // or after with property of the return object of play() - a CreateJS AbstractSoundInstance
          // sound.volume = .5;

          countDownTimer = 10;
        }
      });


      var button = new Button({
        label: "STOP",
        toggle: "START"
      }).addTo(stage).pos(50, 100);;
      button.on("click", function() {
        if (countDownTimer != 0) {
          iv.pause(button.toggled);
        } else {
          countDownTimer = 10;
        }
          frame.asset("C_D_E_D.001.mp3").play();
          particles.pauseEmitter(button.toggled, freeze = true, immediate = true);
      });



      // random x y
      var startPosx = zim.rand(50, stageW - 50);
      var startPosy = zim.rand(50, stageH - 50);
  //var circle = new Circle(10, "#7FFF00").addTo(stage).pos(startPosx, startPosy).drag();

      var circle = new Label({
          text: "üêÑ",
          size: 100,
          align: "center"
        })
        .addTo(stage)
        .pos(startPosx, startPosy)
        .animate({
            obj: {
              alpha: 0
            },
            time: 2000,
            from: true
        })
        .drag();

      var theCenter = new Circle(10, orange).centerReg(stage);



      var particles = new zim.Emitter({
        // obj: [new Circle(20, null, [darker, lighter], 2),
        //   new Rectangle(30, 30, null, [darker, lighter], 2),
        //   new Triangle(40, 40, 40, null, [darker, lighter], 2)
          obj: [
            //new Circle(20, null, [darker, lighter], 2)
            new Label({text: "üò≤",size: 40,align: "center"}),
            new Label({text: "üèÑ",size: 80,align: "center"}),
            new Label({text: "üö¥",size: 80,align: "center"}),
            new Label({text: "üõÄ",size: 80,align: "center"}),
            new Label({text: "üëØ",size: 80,align: "center"}),
            new Label({text: "üë£",size: 80,align: "center"}),
            new Label({text: "üèÉ",size: 80,align: "center"})

        ],
        random: {
          color: colorPal_Gold,
          rotation: {
            min: -360,
            max: 360
          },
          scale: {
            min: 0.4,
            max: 1.0
          }
        },
        interval: 500,
        num: 2,
        life: 8000,
        fade: false,
        shrink: false,
        force: 0.31,
        gravity: 0,
        animation: {
          obj: {
            rotation: ["360", "-360"],
            scale: 0.7
          },
          loop: true,
          time: {
            min: 4000,
            max: 5000
          },
          ease: "linear",
          from: false
        },
        sink: circle,
        sinkForce: 0.3,
        startPaused: false
      }).centerReg(stage);


      var tickerFunction = Ticker.add(function() {
        var p = particles.particles.children; // p is the array of individual Particles
        var numElem = p.length;
        var index = null; // for return value of hit test
        var wasHit = false;
        var cc = 0;

        for (cc = 0; cc < numElem; cc++) {
          wasHit = circle.hitTestBounds(other = p[cc], margin = -10);
          if (wasHit) {
            index = 0;
            break;
          }
        }

        if (index == 0) {
          //  "I am hit";
          var curId = p[cc].id;

          // check if id is in alreadyHitParticlesIds array
          if (alreadyHitParticlesIds.includes(curId)) { // alreaddy hit this one
            p[cc].color = purple;
          } else {
            alreadyHitParticlesIds.push(curId); // not found, add it to array
            hitParticles++;
            p[cc].color = purple;
          }
          //displayHitText.text = "hit particles: " + hitParticles + ", particle id: |" + alreadyHitParticlesIds +  "| Num of Particles: " + particles.particles.children.length;
          //displayHitText.text = "hit particles: " + hitParticles + " total particles: " + particles.particles.children.length;

        } else {
          // nothing was hit
        }
        displayHitText.text = "countDownTimer: " + countDownTimer;
      }, stage);

      var alreadyHitParticlesIds = []; // for storing the id of the particle hit
      //var grid = new zim.Grid({percent:false}).addTo();

      stage.update(); // this is needed to show any changes

    }); // end of ready
  </script>
  <meta name="viewport" content="width=device-width, user-scalable=no" />
</head>

<body>
  <!-- canvas with id="myCanvas" is made by zim Frame -->
</body>

</html>
