<!doctype html>
<html>

<head>
  <meta charset="utf-8" />
  <title>EmitterHitter</title>

  <script src="https://d309knd7es5f10.cloudfront.net/createjs_1.1_min.js"></script>
  <script src="https://d309knd7es5f10.cloudfront.net/zim_10.4.1.js"></script>
  <!-- use zimjs.com/distill for minified individual functions! -->

  <script>
    var frame = //new Frame(scaling, width, height, color, outerColor);
      new Frame(
        "fit",
        window.screen.availWidth,
        window.screen.availHeight,
        "#000",
        "#555"
      );

    frame.on("ready", function() {
      zog("ready from ZIM Frame"); // logs in console (F12 - choose console)

      var stage = frame.stage;
      var stageW = frame.width;
      var stageH = frame.height;

      // put your code here
      var colorPal_Cenicienta3 = ["#034AA6","#022859","#034C8C","#049DBF","#04C4D9"];

      var hitParticles = 0;

      // a text label for displaying the number of hit particles
      var displayHitText = new Label({
          text: "hit particles: " + hitParticles,
          size: 17,
          color: yellow,
          align: "left"
        })
        .addTo(stage)
        .pos(50, 50);

      // green small circle: is users interaction object, might serve as sink
      var circle = new Circle(10, green).addTo(stage).pos(100, 100).drag();

      var theCenter = new Circle(10, orange).centerReg(stage);

      //var aParticle = new Rectangle(40, 40, yellow);
      var aParticle = new Circle(20, null, [darker, lighter], 3);
      var bParticle = new Rectangle(30, 30, null, [darker, lighter], 3);
      var cParticle = new Triangle(40, 40, 40, null, [darker, lighter], 3);

      var particles = new zim.Emitter({
//        obj: [ new Circle(20, null, [darker, lighter], 3),
//               new Rectangle(30, 30, null, [darker, lighter], 3),
//               new Triangle(40, 40, 40, null, [darker, lighter], 3)
//             ],
       obj: [ aParticle,
              bParticle,
              cParticle
            ],
             random: {
                color: colorPal_Cenicienta3,
                rotation: { min: -360, max: 360 },
                scale: { min: 0.1, max: 3.0 }
              },
        interval: 500,
        num: 1,
        life: 3000,
        fade: false,
        shrink: false,
        force: 1,
        gravity: 0,
        animation: {
          obj: { rotation: ["360", "-360"], scale: 0.7 },
          loop: false,
          time: { min: 4000, max: 5000 },
          ease: "linear",
          from: false
        },
        sink: null,
        sinkForce: 0,
        startPaused: false
      }).centerReg(stage);


      var alreadyHitParticlesIds = []; // store the id of the particle hit

      // the circles event pressmove function
      circle.on("pressmove", function(e) {
        var p = particles.particles.children; // p is the array of individual Particles
        var numElem = p.length;
        var index = null; // for return value of hit test
        var cc = 0;

        for (cc = 0; cc < numElem; cc++) {
          index = p[cc].hitTestGrid(p[cc].width, p[cc].height, 1, 1, circle.x, circle.y, 0, 0, 10, 10);
          if (index == 0)
            break;
        }

        if (index == 0) {
          //  "I am hit";
          var curId = p[cc].id;

          // check if id is in alreadyHitParticlesIds array
          if (alreadyHitParticlesIds.includes(curId)) { // alreaddy hit this one

          } else {
              alreadyHitParticlesIds.push(curId);  // not found, add it to array
              hitParticles++;
              p[cc].color = white;
          }
          displayHitText.text = "hit particles: " + hitParticles + ", particle id: " + p[cc].id;
        } else {
          // nothing was hit
        }
      });
      // end of pressmove

      stage.update(); // this is needed to show any changes

    }); // end of ready
  </script>

  <meta name="viewport" content="width=device-width, user-scalable=no" />

</head>

<body>
  <!-- canvas with id="myCanvas" is made by zim Frame -->
</body>

</html>
