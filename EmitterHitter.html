<!doctype html>
<html>

<head>
  <meta charset="utf-8" />
  <title>EmitterHitter</title>

  <script src="https://d309knd7es5f10.cloudfront.net/createjs_1.1_min.js"></script>
  <script src="https://d309knd7es5f10.cloudfront.net/zim_10.4.1.js"></script>
  <!-- use zimjs.com/distill for minified individual functions! -->

  <script>
    var frame = //new Frame(scaling, width, height, color, outerColor);
      new Frame(
        "fit",
        window.screen.availWidth,
        window.screen.availHeight,
        "#000",
        "#555"
      );

    frame.on("ready", function() {
      zog("ready from ZIM Frame"); // logs in console (F12 - choose console)

      var stage = frame.stage;
      var stageW = frame.width;
      var stageH = frame.height;

      // put your code here
      var colorPal_Cenicienta3 = ["#034AA6", "#022859", "#034C8C", "#049DBF", "#04C4D9"];
      var mostPopColours2019 = [
//        "#7FFF00", // UFO Green
        "#FF1493", // Plastic Pink
        "#8A2BE2", // Proton Purple
        "#000080", // Australia
        "#006400", // Brazil
        "#00CED1", // Germany
        "#FFF0F5", // Japan
        "#2E8B57", // Korea
        "#808000", // Taiwan
      ];

      var colorPal_Gold = ["#a67c00", "#bf9b30","#ffbf00","#ffcf40","#ffdc73"];

      var hitParticles = 0;

      var backgroundCircleBelow = new Circle(stageH / 2 + 70, "#111111").centerReg(stage);
      var backgroundCircleTop   = new Circle(stageH / 2 - 50, "#333333").centerReg(stage);

      // a text label for displaying the number of hit particles
      var displayHitText = new Label({
          text: "hit particles: " + hitParticles,
          size: 17,
          color: yellow,
          align: "left"
        })
        .addTo(stage)
        .pos(50, 50);

      // green small circle: is users interaction object, might serve as sink
      var circle = new Circle(10, "#7FFF00").addTo(stage).pos(100, 100).drag();

      var theCenter = new Circle(10, orange).centerReg(stage);

      var particles = new zim.Emitter({
        obj: [new Circle(20, null, [darker, lighter], 2),
          new Rectangle(30, 30, null, [darker, lighter], 2),
          new Triangle(40, 40, 40, null, [darker, lighter], 2)
        ],
        random: {
          color: colorPal_Gold,
          rotation: {
            min: -360,
            max: 0
          },
          scale: {
            min: 0.3,
            max: 1.0
          }
        },
        interval: 200,
        num: 1,
        life: 8000,
        fade: false,
        shrink: false,
        force: 0.71,
        gravity: 0,
        animation: {
          obj: {
            rotation: ["360", "-360"],
            scale: 0.7
          },
          loop: true,
          time: {
            min: 4000,
            max: 5000
          },
          ease: "linear",
          from: false
        },
        sink: null,
        sinkForce: 0,
        startPaused: false
      }).centerReg(stage);

      var tickerFunction = Ticker.add(function() {
        var p = particles.particles.children; // p is the array of individual Particles
        var numElem = p.length;
        var index = null; // for return value of hit test
        var cc = 0;

        for (cc = 0; cc < numElem; cc++) {
          index = p[cc].hitTestGrid(p[cc].width, p[cc].height, 1, 1, circle.x, circle.y, 0, 0, 10, 10);
          if (index == 0)
            break;
        }

        if (index == 0) {
          //  "I am hit";
          var curId = p[cc].id;

          // check if id is in alreadyHitParticlesIds array
          if (alreadyHitParticlesIds.includes(curId)) { // alreaddy hit this one
            p[cc].color = white;

          } else {
            alreadyHitParticlesIds.push(curId); // not found, add it to array
            hitParticles++;
            p[cc].color = white;
          }
          displayHitText.text = "hit particles: " + hitParticles + ", particle id: " + alreadyHitParticlesIds;
        } else {
          // nothing was hit
        } //zog("i am hit");
      }, stage);

      var alreadyHitParticlesIds = []; // store the id of the particle hit

      // end of pressmove

      stage.update(); // this is needed to show any changes

    }); // end of ready
  </script>

  <meta name="viewport" content="width=device-width, user-scalable=no" />

</head>

<body>
  <!-- canvas with id="myCanvas" is made by zim Frame -->
</body>

</html>
