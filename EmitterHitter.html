<!doctype html>
<html>

<head>
  <meta charset="utf-8" />
  <title>EmitterHitter</title>

  <script src="https://d309knd7es5f10.cloudfront.net/createjs_1.1_min.js"></script>
  <script src="https://d309knd7es5f10.cloudfront.net/zim_10.4.1.js"></script>
  <!-- use zimjs.com/distill for minified individual functions! -->

  <script>
    // particle parameters
    var partNum = 1;
    var partForce = 0.31;
    var partSinkForce = 0.3;
    var partInterval = 500;
    var partLife = 8000;
    // level parameters
    var maxTimeInLevel = 15;
    var curLevel = 0;

    var circle; // attracts the particles and is draggable
    var particles; // the Emitter
    var displayHitText; //quick hack

    // assets to be loaded
    var assets = ["C_D_E_D.001.mp3"];
    var path = "assets/";

    var frame = //new Frame(scaling, width, height, color, outerColor);
      new Frame("fit",
        window.screen.availWidth,
        window.screen.availHeight,
        "#000", "#555", assets, path);

    frame.on("ready", function() {
      //      zog("ready from ZIM Frame"); // logs in console (F12 - choose console)

      var stage = frame.stage;
      var stageW = frame.width;
      var stageH = frame.height;

      // put your code here


      var backgroundCircleBelow = new Circle(stageH / 2 + 70, "#111111").centerReg(stage);
      var backgroundCircleTop = new Circle(stageH / 2 - 50, "#333333").centerReg(stage);
      var theCenter = new Circle(10, orange).centerReg(stage);


      // // text label displaying messages
      // var displayHitText = new Label({
      //     text: " ",
      //     size: 17,
      //     color: yellow,
      //     align: "left"
      //   })
      //   .addTo(stage)
      //   .pos(50, 50);

      var countDownTimer = maxTimeInLevel;
      var countingTime = true;

      // repeat after a second = 1000 ms
      var iv = interval(1000, function() {
        if (countingTime == true) {
          if (countDownTimer > 0)
            countDownTimer--;
          else {
            // timer is 0; remove emitter, setup new one with next params
            particles.particles.removeFrom(stage);
            curLevel++;
            countDownTimer = maxTimeInLevel;
            partNum = partNum + 1;
            setUpEmitter();
          }
        }
      });

      function setupButton() {
        // var button = new Button({
        //   label: "STOP",
        //   toggle: "START"
        // }).addTo(stage).pos(50, 100);;
        // button.on("click", function() {
        //   if (countDownTimer != 0) {
        //     iv.pause(button.toggled);
        //   } else {
        //     //countDownTimer = 10;
        //   }
        //   var sound = frame.asset("C_D_E_D.001.mp3").play({
        //     interrupt: "any",
        //     volume: 0.2,
        //     loop: 0,
        //     pan: 0
        //   });
        //   //particles.pauseEmitter(button.toggled, freeze = true, immediate = true);
        // });
      } // end of setupButton

      function setupPlayerToken() {
        // random x y
        var startPosx = zim.rand(50, stageW - 50);
        var startPosy = zim.rand(50, stageH - 50);
        //var circle = new Circle(10, "#7FFF00").addTo(stage).pos(startPosx, startPosy).drag();
        circle = new Label({
            text: "üêÑ",
            size: 40,
            align: "center",
            reg: true  // register point --> center point of label
          })
          .addTo(stage)
          .pos(startPosx, startPosy)
          .animate({
            obj: {
              alpha: 0
            },
            time: 2000,
            from: true
          })
          .drag();
      } // end of setupPlayerToken

      var emojis = [
        new Label({
          text: "üò≤",
          size: 20,
          align: "center"
        }),
        new Label({
          text: "üèÑ",
          size: 40,
          align: "center"
        }),
        new Label({
          text: "üö¥",
          size: 40,
          align: "center"
        }),
        new Label({
          text: "üõÄ",
          size: 40,
          align: "center"
        }),
        new Label({
          text: "üëØ",
          size: 40,
          align: "center"
        }),
        new Label({
          text: "üë£",
          size: 30,
          align: "center"
        }),
        new Label({
          text: "‚≠ê",
          size: 40,
          align: "center"
        }),
        //        new Label({text: "ü•∂",size: 40,align: "center"})
        new Label({
          text: "\u{1F4A9}",
          size: 40,
          align: "center"
        }),
        new Label({
          text: "üë®‚ÄçüöÄ",
          size: 40,
          align: "center"
        }),
        new Label({
          text: "üõ∂",
          size: 40,
          align: "center"
        }),
        new Label({
          text: "üå≥",
          size: 40,
          align: "center"
        })


      ];

      function setUpEmitter() {
        particles = new zim.Emitter({
          // obj: [new Circle(20, null, [darker, lighter], 2),
          //   new Rectangle(30, 30, null, [darker, lighter], 2),
          //   new Triangle(40, 40, 40, null, [darker, lighter], 2)
          obj: [emojis[6]],
          random: {
            //          color: colorPal_Gold,
            rotation: {
              min: -360,
              max: 360
            },
            scale: {
              min: 0.4,
              max: 1.0
            }
          },
          interval: partInterval,
          num: partNum,
          life: partLife,
          fade: false,
          shrink: false,
          force: partForce,
          gravity: 0,
          animation: {
            obj: {
              rotation: ["360", "-360"]
              //, scale: 0.7
            },
            loop: true,
            time: {
              min: 4000,
              max: 5000
            },
            ease: "linear",
            from: false
          },
          sink: circle,
          sinkForce: partSinkForce,
          startPaused: false
        }).centerReg(stage);
      } // end of setUpEmitter


      function setUpUi() {
        var panel;

        panel = new Panel({
        		width:400,
        		height:300,
            titleBar:series("data page 1", "data page 2"),
//        		close:false,
//        		displayClose:false,
        		draggable:true
//        		bar:"Pane"
        	});

          // content for panel 1
          var dataTab1 = new Container(panel.width, panel.height).center(panel);

          // var partNum = 1;
          var stepperPartNum = new Stepper(
            {continuous:false, stepperType:"number", min:1, max:9})
            .pos(15, 50, false, false, dataTab1).sca(.25);
          stepperPartNum.currentValue = partNum;
          stepperPartNum.on("change", function() {
            partNum = stepperPartNum.selectedIndex;
            stage.update();
          });
          new Label({
              text: "partNum",
              size: 17,
              color: black,
              align: "left"
            }).addTo(dataTab1).pos(125, 53);

          // var partForce = 0.31;
          var stepperPartForce = new Stepper(
            {continuous:false, stepperType:"number", min:1, max:9})
            .pos(15, 150, false, false, dataTab1).sca(.25);
          stepperPartForce.currentValue = partForce;
          stepperPartForce.on("change", function() {
            partForce = stepperPartForce.selectedIndex;
            stage.update();
          });
          new Label({
              text: "partForce",
              size: 17,
              color: black,
              align: "left"
            }).addTo(dataTab1).pos(125, 153);

          // var partSinkForce = 0.3;
          // var partInterval = 500;
          // var partLife = 8000;
          // // level parameters
          // var maxTimeInLevel = 15;
          // var curLevel = 0;


          // content for panel 2
          var dataTab2 = new Container(panel.width, panel.height);  // don't .center(panel) yet
          // text label displaying messages
          displayHitText = new Label({
              text: " ",
              size: 17,
              color: black,
              align: "left"
            })
            .addTo(dataTab2)
            .pos(50, 50);

            var button = new Button({
              label: "STOP",
              toggle: "START"
            }).addTo(dataTab2).pos(50, 100);

            button.on("click", function() {
              if (countDownTimer != 0) {
                iv.pause(button.toggled);
              } else {
                //countDownTimer = 10;
              }
              var sound = frame.asset("C_D_E_D.001.mp3").play({
                interrupt: "any",
                volume: 0.2,
                loop: 0,
                pan: 0
              });
              //particles.pauseEmitter(button.toggled, freeze = true, immediate = true);
            });

          // event to change content as panels change
          panel.on("change", function () {
             if (dataTab2.parent) {
                dataTab2.removeFrom();
                dataTab1.center(panel);
             } else {
                dataTab1.removeFrom();
                dataTab2.center(panel);
             }
          });

          panel.addTo().pos(50,50);
      } // end of setUpUi()

      setupPlayerToken();
      setupButton();
      setUpEmitter();
      setUpUi();

      var tickerFunction = Ticker.add(function() {
        var p = particles.particles.children; // p is the array of individual Particles
        var numElem = p.length;
        var index = null; // for return value of hit test
        var wasHit = false;
        var cc = 0;

        for (cc = 0; cc < numElem; cc++) {
          wasHit = circle.hitTestBounds(other = p[cc], margin = -10);
          if (wasHit) {
            index = 0;
            break;
          }
        }

        if (index == 0) {
          //  circle is hit, stop the countdown
          countingTime = false;

          particles.pauseEmitter(true, freeze = true, immediate = true);

          // pulse the player token
          circle.animate({
            props: {
              scale: 2.0
            },
            time: 250,
            ease: "linear",
            loop: 0,
            rewind: true,
            from: false
          });
        } else {
          // nothing was hit
        }
        displayHitText.text = "Current Level: " + curLevel + "  Time: " + countDownTimer;
      }, stage);


      stage.update(); // this is needed to show any changes

    }); // end of ready
  </script>
  <meta name="viewport" content="width=device-width, user-scalable=no" />
</head>

<body>
  <!-- canvas with id="myCanvas" is made by zim Frame -->
</body>

</html>
